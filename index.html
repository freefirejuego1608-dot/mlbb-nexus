<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Flappy Bird Mobile</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#000; overflow:hidden; touch-action:manipulation; font-family:Arial; }
    canvas { display:block; background:#4ec0ca; }
    #start, #gameover {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.75); color:white; display:flex;
      flex-direction:column; align-items:center; justify-content:center;
      font-size:2.5em; text-align:center; z-index:10;
    }
    button {
      margin-top:30px; padding:15px 40px; font-size:1.2em;
      background:#ffb400; border:none; border-radius:12px; cursor:pointer;
    }
  </style>
</head>
<body>

<div id="start">
  <h1>FLAPPY BIRD</h1>
  <p style="font-size:0.6em;">Toca la pantalla para volar</p>
  <button onclick="iniciar()">JUGAR</button>
</div>

<div id="gameover" style="display:none;">
  <h1>Game Over</h1>
  <p>Puntuación: <span id="puntos">0</span></p>
  <button onclick="iniciar()">Jugar de nuevo</button>
</div>

<canvas id="c"></canvas>

<script>
// === VARIABLES GLOBALES ===
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w, h, bird, pipes, score, gameRunning;

// === REDIMENSIONAR CANVAS ===
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// === OBJETO PÁJARO ===
function crearPajaro() {
  bird = {
    x: w * 0.25,
    y: h * 0.5,
    size: Math.min(w,h) * 0.08,
    vy: 0,
    gravity: 0.5,
    jump: -11,
    rot: 0
  };
}

// === TUBOS ===
pipes = [];
score = 0;
gameRunning = false;

function nuevoTubo() {
  const hueco = 150;
  const min = 80;
  const max = h - hueco - 80;
  const top = Math.random() * (max - min) + min;

  pipes.push({
    x: w,
    top: top,
    bottom: top + hueco,
    pasado: false
  });
}

// === INICIAR / REINICIAR JUEGO ===
function iniciar() {
  document.getElementById('start').style.display = 'none';
  document.getElementById('gameover').style.display = 'none';
  
  resize();
  crearPajaro();
  pipes = [];
  score = 0;
  gameRunning = true;
  nuevoTubo();
  loop();
}

// === INPUT (toque o click) ===
canvas.addEventListener('touchstart', saltar);
canvas.addEventListener('click', saltar);
function saltar(e) {
  e.preventDefault();
  if (gameRunning) bird.vy = bird.jump;
}

// === BUCLE PRINCIPAL ===
function loop() {
  // Fondo
  ctx.fillStyle = '#4ec0ca';
  ctx.fillRect(0, 0, w, h);

  // Suelo
  ctx.fillStyle = '#8fce00';
  ctx.fillRect(0, h-50, w, 50);

  if (gameRunning) {
    // Física pájaro
    bird.vy += bird.gravity;
    bird.y += bird.vy;
    bird.rot = Math.min(Math.max(bird.vy * 3, -30), 90);

    // Generar tubos cada 100 frames aprox
    if (pipes.length === 0 || pipes[pipes.length-1].x < w - 300) {
      nuevoTubo();
    }

    // Actualizar y dibujar tubos
    for (let i = pipes.length-1; i >= 0; i--) {
      let p = pipes[i];
      p.x -= 2.5;

      // Dibujar
      ctx.fillStyle = '#4caf50';
      // superior
      ctx.fillRect(p.x, 0, 90, p.top);
      ctx.fillRect(p.x-15, p.top-50, 120, 50);
      // inferior
      ctx.fillRect(p.x, p.bottom, 90, h);
      ctx.fillRect(p.x-15, p.bottom, 120, 50);

      // Colisión
      if (
        bird.x + bird.size/2 > p.x &&
        bird.x - bird.size/2 < p.x + 90 &&
        (bird.y - bird.size/2 < p.top || bird.y + bird.size/2 > p.bottom)
      ) gameRunning = false;

      // Punto
      if (!p.pasado && bird.x > p.x + 90) {
        p.pasado = true;
        score++;
      }

      // Eliminar fuera de pantalla
      if (p.x < -150) pipes.splice(i,1);
    }

    // Colisión suelo/techo
    if (bird.y + bird.size/2 > h-50 || bird.y - bird.size/2 < 0) {
      gameRunning = false;
    }
  }

  // Dibujar pájaro
  ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.rotate(bird.rot * Math.PI / 180);
  
  // cuerpo
  ctx.fillStyle = '#ffeb3b';
  ctx.fillRect(-bird.size/2, -bird.size/2, bird.size, bird.size);
  // ojo
  ctx.fillStyle = 'white';
  ctx.fillRect(bird.size/4, -bird.size/3, bird.size/3, bird.size/3);
  ctx.fillStyle = 'black';
  ctx.fillRect(bird.size/3, -bird.size/4, bird.size/6, bird.size/6);
  // pico
  ctx.fillStyle = '#ff5722';
  ctx.beginPath();
  ctx.moveTo(bird.size/2, 0);
  ctx.lineTo(bird.size, -8);
  ctx.lineTo(bird.size, 8);
  ctx.closePath();
  ctx.fill();
  
  ctx.restore();

  // Puntuación
  ctx.fillStyle = 'white';
  ctx.font = 'bold ' + Math.min(w/8, 80) + 'px Arial';
  ctx.textAlign = 'center';
  ctx.fillText(score, w/2, 100);

  // Game Over
  if (!gameRunning) {
    document.getElementById('puntos').textContent = score;
    document.getElementById('gameover').style.display = 'flex';
  } else {
    requestAnimationFrame(loop);
  }
}

// Iniciar al cargar
window.onload = resize;
</script>
</body>
</html>
